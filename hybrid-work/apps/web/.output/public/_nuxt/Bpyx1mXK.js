import{g as ee,j as te,k as ae,r as c,l as R,m as se,n as ne,p as B,c as o,a,q as m,F as v,s as q,t as l,v as oe,x as re,y as le,o as r,z as j,d as T}from"./Qy2zR8tU.js";import{u as ie}from"./D_leUspb.js";import{u as ue}from"./DBx8DESn.js";const de=globalThis.setInterval,ce={class:"flex flex-1 min-h-0 h-full"},ve={class:"w-[300px] border-r border-gray-200 bg-white overflow-y-auto min-h-0 h-full"},fe={class:"flex items-center justify-between px-4 py-3 text-xs uppercase tracking-wide text-gray-500"},me={key:0,class:"text-[10px] text-gray-400"},pe={class:"space-y-1 px-2"},ye=["onClick"],he={class:"flex flex-col"},xe={class:"font-medium text-gray-900"},ge={key:0,class:"text-[11px] text-gray-500"},_e={class:"truncate text-xs text-gray-500"},be={class:"mt-6 border-t border-gray-200 px-4 pt-4"},we={class:"flex flex-col gap-2"},ke=["onClick"],Ce={class:"flex flex-1 min-h-0 h-full flex-col bg-white overflow-hidden"},Ie={class:"border-b border-gray-200 px-6 py-4 shrink-0"},Se={class:"text-lg font-semibold text-gray-900"},De={key:0,class:"text-sm text-gray-500"},qe={class:"flex-1 overflow-y-auto min-h-0 px-6 py-4"},Te={key:0,class:"text-gray-500"},Ue={key:1,class:"text-gray-500"},$e={key:2,class:"space-y-4"},Le={class:"ml-2 text-xs text-gray-500"},Me={key:0,class:"rounded border border-gray-200 bg-white p-3"},Re={class:"text-sm font-medium text-gray-900"},Ae={class:"text-xs text-gray-500"},Ee={key:0,class:"mt-1 text-xs text-gray-500"},Pe={class:"mt-2 flex flex-wrap gap-2"},Fe=["onClick"],Ne=["onClick"],Be=["onClick"],je={key:1,class:"text-xs text-gray-500"},Oe={key:1,class:"whitespace-pre-line text-gray-900"},Ve={class:"border-t border-gray-200 bg-white px-6 py-4 shrink-0"},ze=["disabled"],Ge=["disabled"],We=ee({__name:"index",setup(He){const d=ie();te();const O=ae(),U=ue("demoUserEmail",()=>"alice@acme.com"),f=c([]),h=c([]),w=c([]),i=c(null),x=c(""),k=c(!1),$=c(!1),L=c(!1),_=c({}),b=c({}),C=c({}),g=R(()=>w.value.find(e=>e.email===U.value)??w.value[0]??null),p=R(()=>f.value.find(e=>e.id===i.value)??null),V=R(()=>w.value.filter(e=>e.id!==g.value?.id)),z=e=>e==="REST"?"ðŸ’¤":e==="FOCUS"?"ðŸŽ¯":"ðŸšª",G=e=>e==="REST"?"Rest":e==="FOCUS"?"Focus":"Out of office",A=e=>{if(e.type==="GROUP")return"Group conversation";const s=e.participants.map(t=>t.user).filter(t=>t.email!==U.value);return s.length?s.map(t=>t.name).join(", "):"Direct message"},H=e=>e.participants.map(s=>s.user.name).join(", ");function J(e){return new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"}).format(new Date(e))}function E(e){return e?new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"}).format(new Date(e)):""}async function P(){w.value=(await d.get("/users")).data}async function I(e){$.value=!0;try{f.value=(await d.get("/threads")).data;const s=O.query.thread??void 0;s&&f.value.some(t=>t.id===s)?i.value=s:e?i.value=e:!i.value&&f.value.length&&(i.value=f.value[0].id)}finally{$.value=!1}}async function K(e){L.value=!0;try{h.value=(await d.get(`/threads/${e}/messages`)).data}finally{L.value=!1}}async function S(){const[e,s]=await Promise.all([d.get("/calendar/requests",{params:{scope:"incoming"}}),d.get("/calendar/requests",{params:{scope:"outgoing"}})]),t={};for(const n of e.data)t[n.id]=n;for(const n of s.data)t[n.id]=n;C.value=t}async function F(){const e=new Set;for(const u of f.value)if(u.type==="DM")for(const M of u.participants){const y=M.user.id;y&&y!==g.value?.id&&e.add(y)}if(!e.size){_.value={};return}const s=new URLSearchParams({userIds:Array.from(e).join(",")}),{data:t}=await d.get(`/calendar/active-blocks?${s.toString()}`),n={};for(const u of t)n[u.ownerId]={kind:u.kind};_.value=n}async function N(){const e=new Set;for(const u of f.value)if(u.type==="DM")for(const M of u.participants){const y=M.user.id;y&&y!==g.value?.id&&e.add(y)}if(!e.size){b.value={};return}const s=new URLSearchParams({userIds:Array.from(e).join(",")}),{data:t}=await d.get(`/presence/users?${s.toString()}`),n={};for(const u of t)n[u.userId]={location:u.location,deskLabel:u.desk?`${u.desk.floorId}-${u.desk.label}`:void 0};b.value=n}async function D(){if(!i.value){h.value=[];return}await K(i.value),await Promise.all([S(),F(),N()])}async function Q(){if(!(!i.value||!x.value.trim())){k.value=!0;try{const{data:e}=await d.post(`/threads/${i.value}/messages`,{body:x.value.trim()});h.value=[...h.value,e],x.value="",await I(i.value),await S()}finally{k.value=!1}}}async function W(e){const{data:s}=await d.post("/threads",{type:"DM",participantIds:[e]});await I(s.id),await D()}function X(e){return!!e.attachments&&e.attachments.kind==="calendar-request"}async function Y(e){await d.patch(`/calendar/requests/${e}`,{status:"APPROVED"}),await S()}async function Z(e){await d.patch(`/calendar/requests/${e}`,{status:"DECLINED"}),await S()}return se(async()=>{await P(),await I(),await D();const e=de(()=>{F(),N()},6e4);ne(()=>clearInterval(e))}),B(i,async(e,s)=>{e&&e!==s&&await D()}),B(U,async()=>{f.value=[],h.value=[],i.value=null,await P(),await I(),await D()}),(e,s)=>(r(),o("div",ce,[a("aside",ve,[a("div",fe,[s[1]||(s[1]=a("span",null,"Threads",-1)),$.value?(r(),o("span",me,"Loadingâ€¦")):m("",!0)]),a("ul",pe,[(r(!0),o(v,null,q(f.value,t=>(r(),o("li",{key:t.id},[a("button",{class:j(["w-full rounded px-3 py-2 text-left text-sm text-gray-800 hover:bg-gray-100",{"bg-gray-100":t.id===i.value}]),onClick:n=>i.value=t.id},[a("div",he,[a("span",xe,l(A(t)),1),t.type==="DM"?(r(),o("span",ge,[(r(!0),o(v,null,q(t.participants,n=>(r(),o(v,{key:n.user.id},[n.user.id!==g.value?.id?(r(),o(v,{key:0},[_.value[n.user.id]?(r(),o(v,{key:0},[a("span",null,l(z(_.value[n.user.id].kind))+" "+l(G(_.value[n.user.id].kind)),1),s[2]||(s[2]=a("span",null," Â· ",-1))],64)):m("",!0),a("span",null," at "+l(b.value[n.user.id]?.location==="OFFICE"&&b.value[n.user.id]?.deskLabel?b.value[n.user.id]?.deskLabel:"home"),1)],64)):m("",!0)],64))),128))])):m("",!0),a("span",_e,[T(l(t.messages[0]?.sender?.name??"No messages yet")+" ",1),t.messages[0]?(r(),o(v,{key:0},[T(" Â· "+l(t.messages[0]?.body),1)],64)):m("",!0)])])],10,ye)]))),128))]),a("div",be,[s[3]||(s[3]=a("h3",{class:"mb-2 text-xs uppercase tracking-wide text-gray-500"},"Start new chat",-1)),a("div",we,[(r(!0),o(v,null,q(V.value,t=>(r(),o("button",{key:t.id,class:"rounded border border-gray-200 px-3 py-2 text-left text-sm text-gray-800 hover:bg-gray-100",onClick:n=>W(t.id)}," Message "+l(t.name),9,ke))),128))])])]),a("section",Ce,[a("header",Ie,[a("h2",Se,l(p.value?A(p.value):"Select a thread"),1),p.value?(r(),o("p",De,l(H(p.value)),1)):m("",!0)]),a("div",qe,[p.value?L.value?(r(),o("div",Ue,"Loading messagesâ€¦")):(r(),o("ul",$e,[(r(!0),o(v,null,q(h.value,t=>(r(),o("li",{key:t.id,class:"flex flex-col gap-2"},[a("div",null,[a("span",{class:j(["text-sm font-medium",t.sender.id===g.value?.id?"text-emerald-700":"text-gray-800"])},l(t.sender.name),3),a("span",Le,l(J(t.createdAt)),1)]),X(t)?(r(),o("div",Me,[a("div",Re,"Calendar request: "+l(t.attachments.title),1),a("div",Ae,[T(l(E(t.attachments.startsAt))+" ",1),t.attachments.endsAt?(r(),o(v,{key:0},[T(" â€“ "+l(E(t.attachments.endsAt)),1)],64)):m("",!0)]),t.attachments.location?(r(),o("div",Ee," Location: "+l(t.attachments.location),1)):m("",!0),a("div",Pe,[a("button",{class:"rounded border border-gray-300 bg-white px-2 py-1 text-xs",onClick:n=>e.routerPushCalendar(t.attachments.targetUserId)}," View in Calendar ",8,Fe),C.value[t.attachments.requestId]?.status==="PENDING"&&C.value[t.attachments.requestId]?.targetUser.id===g.value?.id?(r(),o(v,{key:0},[a("button",{class:"rounded bg-emerald-500 px-2 py-1 text-xs font-medium text-emerald-950",onClick:n=>Y(t.attachments.requestId)}," Approve ",8,Ne),a("button",{class:"rounded bg-gray-200 px-2 py-1 text-xs",onClick:n=>Z(t.attachments.requestId)}," Decline ",8,Be)],64)):(r(),o("span",je," Status: "+l(C.value[t.attachments.requestId]?.status||"PENDING"),1))])])):(r(),o("p",Oe,l(t.body),1))]))),128))])):(r(),o("div",Te,"Choose a conversation or start a new one."))]),a("footer",Ve,[a("form",{class:"flex gap-3",onSubmit:oe(Q,["prevent"])},[re(a("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>x.value=t),class:"flex-1 rounded border border-gray-300 bg-white px-3 py-2 text-gray-900 focus:border-emerald-400 focus:outline-none",placeholder:"Type a message",disabled:!p.value},null,8,ze),[[le,x.value]]),a("button",{class:"rounded bg-emerald-500 px-4 py-2 text-sm font-medium text-emerald-950 disabled:cursor-not-allowed disabled:bg-emerald-300",type:"submit",disabled:!p.value||!x.value.trim()||k.value},l(k.value?"Sendingâ€¦":"Send"),9,Ge)],32)])])]))}});export{We as default};
