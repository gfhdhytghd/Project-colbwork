import{u as E}from"./D_leUspb.js";import{u as F}from"./DBx8DESn.js";import{g as O,r,l as A,j as I,m as L,p as $,c as l,a,q as b,t as d,F as B,s as V,A as q,o as n,z as N}from"./Qy2zR8tU.js";const T={class:"p-6 bg-white text-gray-900 flex-1 min-h-0"},U={class:"mb-4 flex items-center justify-between"},j={key:0,class:"flex items-center gap-3 text-sm"},z=["disabled"],G={key:0,class:"text-gray-500"},H={key:1,class:"rounded border border-gray-200 bg-white p-4 text-sm text-gray-600"},J={key:2,class:"grid grid-cols-[1fr_320px] gap-6 min-h-0"},K={viewBox:"0 0 1200 800",class:"h-full min-h-[400px] w-full rounded border border-gray-200 bg-white"},P=["x","y","onClick"],Q=["x","y"],W={key:0,class:"rounded border border-gray-200 bg-white p-4"},X={class:"mb-3 text-sm text-gray-500"},Y={key:0,class:"rounded border border-red-200 bg-red-50 p-2 text-xs text-red-700"},Z={key:1,class:"rounded border border-emerald-200 bg-emerald-50 p-2 text-xs text-emerald-700"},ee={key:2,class:"space-y-3"},se={class:"text-base font-medium text-gray-900"},te={class:"flex gap-2"},ae={key:3,class:"space-y-3"},le=["disabled"],ie=O({__name:"index",setup(ne){const y=E(),i=r([]),h=r(!0),_=r(null),o=r(null),c=r(null),f=r(!1),p=r(!1),v=r(null),u=r(null),k=F("demoUserEmail",()=>"alice@acme.com"),x=A(()=>o.value?w(o.value):null);async function g(){h.value=!0,_.value=null;try{const{data:t}=await y.get("/desks",{params:{floor:"F1"}}),e=t;if(i.value=e,o.value){const s=e.find(m=>m.id===o.value.id)||null;o.value=s}D()}catch(t){_.value=t?.message||"Failed to load desks",i.value=[]}finally{h.value=!1}}function D(){const t=k.value;for(const e of i.value){const s=(e.reservations||[]).find(m=>m.status==="ACTIVE"&&m.user?.email===t);if(s){c.value=s;return}}c.value=null}function w(t){return(t.reservations||[])[0]?.user??null}async function R(){if(o.value){f.value=!0,v.value=null,u.value=null;try{const t=new Date,e=new Date(t.getTime()+14400*1e3);await y.post(`/desks/${o.value.id}/reservations`,{startsAt:t.toISOString(),endsAt:e.toISOString()}),await g(),o.value=i.value.find(s=>s.id===o.value.id)||null,u.value="Desk reserved successfully"}catch(t){v.value=t?.response?.data?.message||t?.message||"Failed to reserve desk"}finally{f.value=!1}}}async function S(){if(c.value){p.value=!0,v.value=null,u.value=null;try{await y.delete(`/desks/reservations/${c.value.id}`),await g(),u.value="Reservation cancelled"}finally{p.value=!1}}}const C=I();async function M(t){const{data:e}=await y.post("/threads",{type:"DM",participantIds:[t]});C.push({path:"/chat",query:{thread:e.id}})}return L(g),$(k,g),(t,e)=>(n(),l("div",T,[a("div",U,[e[3]||(e[3]=a("h1",{class:"text-2xl font-semibold"},"Office Map",-1)),c.value?(n(),l("div",j,[e[2]||(e[2]=a("span",null,"My desk active",-1)),a("button",{class:"rounded bg-gray-200 px-3 py-1",disabled:p.value,onClick:S},d(p.value?"Leaving…":"Leave desk"),9,z)])):b("",!0)]),h.value?(n(),l("div",G,"Loading desks…")):i.value.length?(n(),l("div",J,[(n(),l("svg",K,[(n(!0),l(B,null,V(i.value,s=>(n(),l("g",{key:s.id},[a("rect",{x:s.x,y:s.y,width:"60",height:"40",rx:"6",class:N(w(s)?"fill-red-300 stroke-red-400 cursor-pointer":"fill-emerald-300 stroke-emerald-400 cursor-pointer"),onClick:m=>o.value=s},null,10,P),a("text",{x:s.x+30,y:s.y+25,"text-anchor":"middle",class:"fill-gray-900 text-xs select-none"},d(s.label),9,Q)]))),128))])),o.value?(n(),l("aside",W,[a("div",X,"Desk "+d(o.value.label),1),v.value?(n(),l("p",Y,d(v.value),1)):b("",!0),u.value?(n(),l("p",Z,d(u.value),1)):b("",!0),x.value?(n(),l("div",ee,[a("div",null,[e[4]||(e[4]=a("div",{class:"text-sm text-gray-500"},"Occupied by",-1)),a("div",se,d(x.value.name),1)]),a("div",te,[a("button",{class:"rounded bg-emerald-500 px-3 py-2 text-sm font-medium text-emerald-950",onClick:e[0]||(e[0]=s=>M(x.value.id))}," Message "),a("button",{class:"rounded bg-gray-200 px-3 py-2 text-sm",onClick:e[1]||(e[1]=s=>q(C).push({path:"/calendar",query:{owner:x.value.id}}))}," View calendar ")])])):(n(),l("div",ae,[e[5]||(e[5]=a("div",{class:"text-sm text-gray-500"},"This desk is available.",-1)),a("button",{class:"rounded bg-emerald-500 px-3 py-2 text-sm font-medium text-emerald-950",disabled:f.value,onClick:R},d(f.value?"Reserving…":"Reserve for 4h"),9,le)]))])):b("",!0)])):(n(),l("div",H," No desks found on floor F1. If you recently reset the database, please run the seed script and reload. "))]))}});export{ie as default};
